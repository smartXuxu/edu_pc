<!DOCTYPE html>
<html>
<head lang="en">
    <link rel="shortcut icon " type="images/x-icon" href="../../ico.ico">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>消息 管理</title>
    <!-- Bootstrap -->
    <link href="../../css/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/iconfont.css" rel="stylesheet">
    <link href="../../css/upload/upload.css" rel="stylesheet">
    <link href="../../css/upload/auth.css" rel="stylesheet">
    <link href="../../css/upload/message_manage.css" rel="stylesheet">
    <link href="../../css/sweetalert2.css" rel="stylesheet">
</head>
<body>
<div class="layer">
    <div class="header"></div>
    <div class="main">
        <div class="p_center clearfix">
            <div class="mine_left f_left">
                <div class="left_top">
                    <div class="box_img">
                    </div>
                    <div class="left_top_center">
                        <img src="../../img/logo%20(2).png" alt=""/>
                        <h3>猴姆教学</h3>
                        <a href="javascript:;">个人中心</a>
                    </div>
                </div>
                <div class="left_middle">
                    <a href="../upload/mine_study.html" > 学习中心</a>
                   <!-- <a href="../upload/edu_manage.html"> 教务管理</a>-->
                    <a href="../upload/message_manage.html"> 消息管理</a>
                    <a href="../upload/mine_authentication.html"> 认证管理</a>
                    <a href="../upload/account_manage.html"> 账号管理</a>

                </div>
                <div class="left_bottom">
                    <h3>意见反馈</h3>
                    <textarea placeholder="有话您说，我们在倾听..."></textarea>
                    <button>提交</button>
                </div>
            </div>
            <div class="manage_right f_left">
              <!--  <div class="manage">
                    <div class="tit clearfix">
                        <span>【系统】  恭喜您已通过猴姆实系统已通过猴姆实系统已通过猴姆实系统】  恭喜您已通过猴姆实名认证！</span>
                        <em class="f_right">2018-08-10  15:52</em>
                    </div>
                    <div class="info">
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                    </div>
                </div>
                <div class="manage">
                    <div class="tit clearfix">
                        <span>【系统】  恭喜您已通过猴姆实系统已通过猴姆实系统已通过猴姆实系统】  恭喜您已通过猴姆实名认证！</span>
                        <em class="f_right">2018-08-10  15:52</em>
                    </div>
                    <div class="info">
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                    </div>
                </div>
                <div class="manage">
                    <div class="tit clearfix">
                        <span>【系统】  恭喜您已通过猴姆实系统已通过猴姆实系统已通过猴姆实系统】  恭喜您已通过猴姆实名认证！</span>
                        <em class="f_right">2018-08-10  15:52</em>
                    </div>
                    <div class="info">
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                        【系统】  恭喜您已通过猴姆实名认证！
                    </div>
                </div>-->
            </div>
        </div>
    </div>

    <div class="footer"></div>
</div>
</body>
<!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
<!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
<!--[if lt IE 9]>
<script src="../../js/bootstrap/html5shiv.main.js"></script>
<script src="../../js/bootstrap/respond.min.js"></script>
<![endif]-->
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="../../js/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="../../js/bootstrap/bootstrap.min.js"></script>
<script src="../../js/base.js"></script>
<script src="../../js/sweetalert2.js"></script>

<script>
    $(function () {
        var userid=localStorage.getItem("this_userid");
        var token=localStorage.getItem('token');
        $(".header").load("../common/header_logo.html");
        $(".left").load("../common/mine_index.html");
        $(".footer").load("../common/footer.html");
        setTimeout(function () {
            $(".left_middle>a:nth-of-type(2)").addClass("active");
        },100)
        //头像显示
        if(localStorage.getItem("this_pic")){
            $(".mine_left .left_top_center>img").attr("src",localStorage.getItem("this_pic"))
        }else{
            // logo%20(2).png
            $(".mine_left .left_top_center>img").attr("src",'logo%20(2).png')
        }
        var nickName=localStorage.getItem("this_nickName")
        if(nickName==""){
            nickName="猴姆教学"
        }
        $(".left_top_center>h3").text(`${ nickName}`)

        //我的消息
        ajaxs("/core/my/messages",'post',true,{userid:userid},function(data){
            if(data.status==200){
                if(data.data==null||data.data.length==0){
                    $(".manage_right").html(`<div class='no_in'>对不起，您暂时没有任何消息</div>`)
                }else{
                    var datas=data.data,ks="",kkk="";
                    for(i in datas){
                        var timestamp=new Date().getTime()-datas[i].createTime;//当前时间戳-发布时间戳
                        var timea="";
                        var sec=parseInt(timestamp/1000);//秒
                        var min=parseInt(sec/60);//分
                        var hour=parseInt(min/60);//时
                        var day=parseInt(hour/24);//天
                        if(sec<60){
                            timea="刚刚";
                        }else if(min<60){
                            timea=min+"分钟前";
                        }else if(hour<24){
                            timea=hour+"小时前";
                        }else if(day<7){
                            timea=day+"天前";
                        }else{
                            timea=new Date(datas[i].createTime).toLocaleString().replace(/:\d{1,2}$/,' ').replace(/\//g, "-");
                        }

                        ajaxs("/core/get/message/details",'post',false,{messageid:datas[i].id},function(data){
                            kkk=data.data.messages.content;
                        },function(err){
                            console.log(err);
                        })
                        ks+=`<div class="manage">
                                <div class="tit clearfix">
                                <span>${datas[i].title}</span>
                                <em class="f_right">${timea}</em>
                                </div>
                                <div class="info">${kkk}</div>
                                </div>`;

                        $(".manage_right").html(ks);
                        $(".manage_right").on("click",".tit",function(){
                            $(this).siblings(".info").toggle();
                            $(this).parent().siblings(".manage").children(".tit").siblings(".info").fadeOut();
                        })
                    }
                }
            }

        },function(err){
            console.log(err);
        })

    })
</script>
</html>