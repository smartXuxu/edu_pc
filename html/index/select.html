<!DOCTYPE html>
<html>
<head lang="en">
    <link rel="shortcut icon " type="images/x-icon" href="../../ico.ico">
    <meta charset="UTF-8">
    <title>搜索页</title>
    <link rel="stylesheet" href="../../css/base.css"/>
    <link rel="stylesheet" href="../../css/sweetalert2.css"/>
    <link rel="stylesheet" href="../../css/index/select.css"/>
</head>
<body>
<div class="layer" style="overflow-x: hidden">
    <div class="header"></div>
    <div class="main">
        <div class="input p_center">
            <input type="text" id='search' placeholder="请输入您要搜索的内容"/>
            <button class="result search-btn">点击搜索</button>
        </div>
        <div class="searchResult p_center">
            <div class="hot_search">
                <div class="hot_tit">
                    <span>最近搜索</span>
                    <i class="clear-history">清除</i>
                </div>
                <div class="content search-history-list">
                   <!-- <span>高三数学</span>-->
                    <!--tianco-->
                </div>
            </div>
            <div class="search_lately">
                <!-- 内容-->
                <h2>热门搜索</h2>
                <div class="search_lately_content">
                  <!--   <span>高三数学</span>-->
                </div>
            </div>
            <div id="consequence">
               <!-- &lt;!&ndash;学校&ndash;&gt;
                <div class="school">
                   <h3>返回的学校有:</h3>
                    <ul class="clearfix">
                            <li>
                                <a href="../index/edu_index.html?id=1">
                                    <img src="../../img/index_school.png" alt="">
                                    <div class="text">
                                        <h3>伊河路小学</h3>
                                        <div class="grade">
                                            <span>小学</span>
                                        </div>
                                        <p>. 郑州市中原区伊河路与工人路路口伊河路小学</p>
                                    </div>
                                </a>
                            </li>
                        </ul>
                </div>
                &lt;!&ndash;课堂&ndash;&gt;
                <div class="lesson">
                    <h3>返回的课程有:</h3>
                    <ul class="clearfix">
                        <li>
                            <a href="./video.html?id=5">
                                <div class="img_box">
                                    <img onerror="this.src='../../img/index_edu.png'" src="http://39.104.127.252:80/group1/M00/00/26/rBhwr1wXDjeAaSwFAARNdcWWQuU488.png" alt="">
                                </div>
                                <div class="bottom">
                                    <p>2018年学前班下学期美术黄老师的课程</p>
                                    <h5>主讲老师：猪八戒</h5>
                                    <div class="new">黄老师的课程 更新至:第5课时</div>
                                    <div class="b_footer">
                                        <ul class="clearfix">
                                            <li>
                                                <em class="iconfont icon-wode1">1</em>
                                            </li>
                                            <li>
                                                <em class="iconfont icon-wujiaoxingkong">0</em>
                                            </li>
                                            <li>
                                                <em class="iconfont icon-xin1">0</em>
                                            </li>
                                        </ul>
                                        <span>| &nbsp;&nbsp;&nbsp;&nbsp;1人学习中</span>
                                    </div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
                &lt;!&ndash;教师&ndash;&gt;
                <div class="teacher">
                    <h3>返回的教师:</h3>
                    <ul class="clearfix">
                        <li>
                            <a href="../famous_teacher/teacher_index.html?id=2">
                                <img src="http://39.104.127.252:80/group1/M00/00/24/rBhwr1wQXUqAXxaNAAy1x_iI9Qc016.png" alt="">
                                <div class="text">
                                    <h3>猪八戒</h3>

                                    <div class="grade">
                                        伊河路小学
                                    </div>
                                    <p>老师</p>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>-->
                <!-- <div class="list_school" onclick="location.href='./edu_index.html'">
                           <div class="img_box">
                               <img src="../../img/index_school.png" alt="">

                           </div>
                           <div class="right">
                               <em class="clearfix">华南师范大学 <del>1.2km</del></em>

                               <div class="right_center">
                                   <em></em> 1&lt;!&ndash;这是什么？&ndash;&gt;
                                   &nbsp;&nbsp;&nbsp;&nbsp;<del>高中</del>
                                   &nbsp;&nbsp;&nbsp;&nbsp;<del>初中</del>
                               </div>
                               <div class="right_footer">
                                   <i class="iconfont icon-zuobiao"></i>
                                   <span>广州市天河区中山广州市天河区中山大道西1路</span>
                               </div>
                           </div>
                       </div>
                <div class="list_teacher" onclick="location.href='../index/teacher_index.html'">
                        <img src="../../img/focus-img1.png" alt="">
                        <div class="list_center">
                            <div class="list_center_top clearfix">
                                <span>傅娟 </span><i class="f_right">1.2km</i>
                            </div>
                            <div class="list_center_center clearfix">
                                <em>数学</em>
                                <em>初二</em>
                                <s class="f_right">在线</s>
                            </div>
                            <div class="list_bottom">
                                华南师范大学附属中学
                            </div>
                        </div>
                    </div>
                <div class="list_course">
                    <a href="./index_video.html">
                        <img src="../../img/index_edu.png" alt="">
                        <div class="ex_right">
                            <div class="ex_top clearfix">
                                <span>主讲：傅娟</span>&nbsp;&nbsp;&nbsp;&nbsp;
                                <em class="f_right"><del>11023</del>人学习</em>
                            </div>
                            <div class="ex_center">
                                2018-07-15  更新第10课时更新第10课时
                            </div>
                            <div class="ex_footer">
                                华南师范大学附属中学师范大学附属中学
                            </div>
                        </div>
                    </a>
                </div>-->
            </div>
        </div>
    </div>
    <div class="footer"></div>
</div>
</body>
<script src="../../js/jquery.min.js"></script>
<script src="../../js/base.js"></script>
<script src="../../js/sweetalert2.js"></script>
<script src="../../js/template-web.js"></script>
<script src="../../js/template.js"></script>
<script>
    template.helper("time",function(date){
        var time=new Date(date).toLocaleString().replace(/:\d{1,2}$/,' ').substr(5,11).replace("/","-");
        return time;
        /* return new Date(parseInt(date) * 1000).toLocaleString().replace(/:\d{1,2}$/,' ');*/
    });
</script>
<script type="text/template" id="historyTpl">
    {{if list.length ==0}}
    <p class="no_info">对不起，暂时没有搜索记录！</p>
    {{else}}
    {{each list as value i}}
    <span class="searchList">{{value}}</span>
    {{/each}}
    {{/if}}
</script>
<script id="hotSearch" type="text/html">
    {{if data.length==0}}
    <span>高三数学</span>
    {{else}}
    {{each data as value i}}
    <span>{{value}}</span>
    {{/each}}
    {{/if}}
</script>
<script type="text/html" id="result">
    {{if data==null||data.length==0}}
    <div class="no_in">对不起，暂时没有搜索结果</div>
    {{else}}
    <!--教师-->
    {{if !data.searchTeacher|| data.searchTeacher!==null||data.searchTeacher.length!==0}}
    <div class="teacher">
        <h3>返回的教师有:</h3>
        {{if !data.searchTeacher}}
        <div class="no_info">对不起，暂时没有符合条件的教师</div>
        {{/if}}
        <ul class="clearfix">
            {{each data.searchTeacher as teacher i}}
            <li>
                <a href="../famous_teacher/teacher_index.html?id={{teacher.teacher.userid}}">
                    <img src="{{teacher.teacher.portrait==null?'../../img/logo.png':teacher.teacher.portrait}}" alt="">
                    <div class="text">
                        <h3>{{teacher.teacher.nickname==null?teacher.teacher.realName==null?"猴姆教学":teacher.teacher.realName:teacher.teacher.nickname}}</h3>
                        <div class="grade">
                          {{teacher.schoolName}}
                        </div>
                        <p>教师</p>
                    </div>
                </a>
            </li>
            {{/each}}
        </ul>
        </div>
    {{/if}}
    <!--学校-->
    {{if data.searchSchool!==null||data.searchSchool.length!==0}}
       <div class="school">
           <h3>返回的学校有:</h3>
           {{if !data.searchSchool}}
           <div class="no_info">对不起，暂时没有符合条件的学校</div>
           {{/if}}
           <ul class="clearfix">
    {{each data.searchSchool as school i}}
    <li>
        <a href="../school/edu_index.html?id={{school.school.schoolId}}">
            <img src="{{school.school.portrait==null?'../../img/index_school.png':school.school.portrait}}" alt="">
            <div class="text">
                <h3>{{school.school.name}}</h3>
                <div class="grade">
                    <span>{{school.school.containClasses}}</span>
                </div>
                <p>. {{school.school.address}}</p>
            </div>
        </a>
    </li>
    {{/each}}
           </ul>
       </div>
    {{/if}}
    <!--课程-->
    {{if data.searchCourse!==null||data.searchCourse.length!==0}}
    <div class="lesson">
        <h3>返回的课程有:</h3>
        {{if !data.searchCourse}}
        <div class="no_info">对不起，暂时没有符合条件的课程</div>
        {{/if}}
        <ul class="clearfix">
         {{each data.searchCourse as course i}}
            <li>
                <a href="../lesson/video.html?id={{course.course.id}}">
                    <div class="img_box">
                        <img onerror="this.src='../../img/index_edu.png'" src="{{course.course.coursePicture==null?'../../img/index_edu.png':course.course.coursePicture}}" alt="">
                    </div>
                    <div class="bottom">
                        <p>{{course.course.academicYear}}{{course.course.grade}}{{course.course.semester}}{{course.course.subject}}{{course.course.name}}</p>
                        <h5>主讲老师：{{course.speaker}}</h5>
                        <div class="new">{{course.course.name}} 更新至:第{{course.updateNum}}课时</div>
                        <div class="b_footer">
                            <ul class="clearfix">
                                <li>
                                    <em class="iconfont icon-wode1">{{course.StudyCourseNum}}</em>
                                </li>
                                <li>
                                    <em class="iconfont icon-wujiaoxingkong">{{course.CourseCollectNum}}</em>
                                </li>
                                <li>
                                    <em class="iconfont icon-xin1">{{course.CourseLoveNum}}</em>
                                </li>
                            </ul>
                            <span>| &nbsp;&nbsp;&nbsp;&nbsp;{{course.StudyCourseNum}}人学习中</span>
                        </div>
                    </div>
                </a>
            </li>
        {{/each}}
        </ul>
    </div>
    {{/if}}
    {{/if}}

</script>
<script>
    $(function () {
        setTimeout(function () {
            $(".header").load("../common/header_logo.html");
            $(".footer").load("../common/footer.html");

        },100)
        setTimeout(function () {
            $("header>nav>.search").hide();
        },500);
        /*热门搜索*/
        myAjax({url:"/search/hot/history",type:"post"},function(data){
            console.log(data);
            //data=data.slice(0,10);
            $(".search_lately_content").html(template('hotSearch',{data:data.data.slice(0,5)}))
            $(".main").on("click",".search_lately_content>span", function () {
                $("#search").val($(this).text());
            })
        })
        /* 点击搜索按钮，发送请求*/
        /*都会和localStorage   约定一个键  leTaoHistory */
        /*1渲染列表*/
        /*获取*/
        var historyList = getHistoryData();
        /*渲染*/
        $('.search-history-list').html(template('historyTpl',{list:historyList}));
        $('#search').val('');
        $(".main").on("click",".searchList", function () {
            var text= $(this).text();
            console.log(text);
            $("#search").val(text);
        })
        /*2点击搜索*/
        $(".search-btn").click(function(){
            /*获取关键字*/
            var key = $.trim($('#search').val());
            /*如果用户没有输入*/
            if(!key){
                /*提示*/
               sweetAlert(
                       "sorry",
                       "请您输入搜索的内容",
                       "error"
               )
                return false;
            }else{
                //发送请求添加搜索历史
                myAjax({url:"/search/add/history",data:{searchContent:key},type:"post"}, function (data) {
                    console.log(data);
                    //搜索历史
                })
                myAjax({url:"/search/get/search/all",data:{search:key},type:"post"}, function (data) {
                    console.log(data);
                    //搜索全部  教师课程 学校
                    if(data.status==200){
                        /*优化 判断 返回的是一个空数组*/
                        if(JSON.stringify(data.data) == "{}"){
                            sweetAlert(
                                    "sorry",
                                    "对不起，暂时没有符合您搜索条件的数据",
                                    "error"
                            )
                            return false;
                        }

                        // 渲染
                        $("#consequence").html(template("result",data))
                    }
                })
            }
            /* //var city=localStorage.getItem("city");
             function render(data){
             console.log(data);
             //页面重绘
             if(data.code==200){
             $(".news_list").html(template("searchResult",data));
             }
             }
             // myAjax({url:"/station/searchByKey",data:{city:city,key:key},type:"post"},render);
             myAjax({url:"/station/search",data:{key:key},type:"post"},render);
             */
            /*记录这一次的搜索*/
            var arr = getHistoryData();

            /*1.在正常的10条记录内 正常添加*/
            /*2.已经10条记录了    添加一条 并且 删除最早的一条 */
            /*3.如果有相同记录    添加一条 并且 删除相同的一条 */
            /*是否有相同数据*/
            var isHave = false;
            var haveIndex;
            for(var i = 0 ; i < arr.length ; i ++){
                if(key == arr[i]){
                    isHave = true;
                    haveIndex = i;
                    break;
                }
            }
            if(isHave){
                /*3.如果有相同记录*/
                arr.push(key);
                /*删除*/
                arr.splice(haveIndex,1);
            }else{
                if(arr.length < 5){
                    /*1.在正常的10条*/
                    arr.push(key);
                }else{
                    /*已经10条记录*/
                    arr.push(key);
                    /*清除第一条*/
                    arr.splice(0,1);
                }
            }
            /*存起来*/
            localStorage.setItem('MuHistory',JSON.stringify(arr));
            $("#search").val("");
            // console.log({list:arr});
            $('.search-history-list').html(template('historyTpl',{list:arr.reverse()}));
            /*跳转搜索列表*/
            // location.href = 'searchList.html?key='+key;
        })

        /*4清空记录*/
        $(".clear-history").click(function(){
            localStorage.setItem('MuHistory','');
            $('.content').html(template('historyTpl',{list:[]}));
        })

    })
    /*获取存储数据*/
    var getHistoryData = function(){
        /*1.约定一个键  leTaoHistory 值存的是json格式的字符串*/
        /*2.通过这个键获取值 如果有就使用 如果没有默认空数组的字符串*/
        var str = localStorage.getItem('MuHistory')||'[]';
        /*3.转成成js数据*/
        var arr = JSON.parse(str);
        /*4.返回js可操作的数组*/
        return arr;
    }
</script>
</html>